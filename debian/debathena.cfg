
/*
 * debathena.cfg
 * 
 * Mozilla Thunderbird MIT/Athena Autoconfig Script
 * Copyright © 2006 Charles Dominguez
 * Copyright © 2009 Evan Broder
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
 *
 */


try
{
	// Kerberos Authentication
	// defaultPref("network.negotiate-auth.trusted-uris", "imap://po*.mit.edu,imaps://po*.mit.edu");
	// defaultPref("network.negotiate-auth.using-native-gsslib", true);
	// defaultPref("network.negotiate-auth.allow-proxies", true);
	// defaultPref("network.auth.use-sspi", false);
	
	var username = getenv("ATHENA_USER");
	if(username == "")
	{
		username = getenv("USER");
	}
	// Check that username is sane
	if(username == null || username == '' || username == 'root')
	{
		throw "Failed to retrieve user name (environment corruption)";
	}

	var fullname = getenv("NAME");
	if(fullname == null || fullname == "")
	{
		throw "Failed to retrieve full name";
	}

	var pobox = getenv("POBOX");
	if(pobox == null || username == '')
	{
		throw "Failed to retrieve the PO box";
	}
	
	
	// Construct additional user settings
	email = username+'@mit.edu';
	imapURI='imap://'+username+'@mit.edu';
	imapRoot='imap://'+username+'@'+pobox+'/INBOX';
	
	// Register accounts
	defaultPref("mail.account.account1.identities", "id1");
	defaultPref("mail.account.account1.server", "server1");
	defaultPref("mail.account.account2.server", "server2");
	defaultPref("mail.accountmanager.localfoldersserver", "server2");
	defaultPref("mail.accountmanager.accounts", "account1,account2");
	defaultPref("mail.accountmanager.defaultaccount", "account1");
	defaultPref("mail.smtp.defaultserver", "smtp1");
	defaultPref("mail.smtpservers", "smtp1");
		
	// Setup MIT Mail Server
	defaultPref("mail.server.server1.hostname", pobox);
	defaultPref("mail.server.server1.name", email);
	defaultPref("mail.server.server1.port", 993);
	defaultPref("mail.server.server1.serverFilterName", "SpamAssassin");
	defaultPref("mail.server.server1.socketType", 3);
	defaultPref("mail.server.server1.type", "imap");
	defaultPref("mail.server.server1.userName", username);

	defaultPref("mail.server.server1.manualMark", true);
	defaultPref("mail.server.server1.moveTargetMode", 1);
	defaultPref("mail.server.server1.spamActionTargetAccount", imapURI);
	defaultPref("mail.server.server1.spamActionTargetFolder", imapRoot+'/Spamscreen');
	defaultPref("mail.server.server1.useServerFilter", true);
	
	// Setup Local Folders Server
	defaultPref("mail.server.server2.directory-rel", "[ProfD]Mail/Local Folders");
	defaultPref("mail.server.server2.hostname", "Local Folders");
	defaultPref("mail.server.server2.name", "Local Folders");
	defaultPref("mail.server.server2.type", "none");
	defaultPref("mail.server.server2.userName", "nobody");

	// Setup Outgoing (SMTP) Server
	defaultPref("mail.smtpserver.smtp1.auth_method", 1);
	defaultPref("mail.smtpserver.smtp1.description", "MIT SMTP Server");
	defaultPref("mail.smtpserver.smtp1.hostname", "outgoing.mit.edu");
	defaultPref("mail.smtpserver.smtp1.port", 465);
	defaultPref("mail.smtpserver.smtp1.try_ssl", 3);
	defaultPref("mail.smtpserver.smtp1.username", username);
	
	// Setup MIT Email Identity
	defaultPref("mail.identity.id1.fullName", fullname);
	defaultPref("mail.identity.id1.useremail", email);
	defaultPref("mail.identity.id1.valid", true);
	defaultPref("mail.identity.id1.directoryServer", "ldap_2.servers.MITCampusDirectory");
	defaultPref("mail.identity.id1.smtpServer", "smtp1");
	
	defaultPref("mail.identity.id1.fcc", true);
	defaultPref("mail.identity.id1.fcc_folder_picker_mode", "0");
	defaultPref("mail.identity.id1.fcc_folder", "mailbox://nobody@Local%20Folders/Sent");
	defaultPref("mail.identity.id1.drafts_folder_picker_mode", "0");
	defaultPref("mail.identity.id1.draft_folder", "mailbox://nobody@Local%20Folders/Drafts");
	defaultPref("mail.identity.id1.tmpl_folder_picker_mode", "0");
	defaultPref("mail.identity.id1.stationery_folder", "mailbox://nobody@Local%20Folders/Templates");
	
	// Setup LDAP Servers & Addressbooks
	defaultPref("ldap_2.servers.MITCampusDirectory.auth.savePassword", false);
	defaultPref("ldap_2.servers.MITCampusDirectory.description", "MIT LDAP");
	defaultPref("ldap_2.servers.MITCampusDirectory.filename", "MIT_LDAP.mab");
	defaultPref("ldap_2.servers.MITCampusDirectory.uri", "ldaps://ldap.mit.edu:636/dc=mit,dc=edu??sub?(objectclass=*)");
}
catch(e)
{
	displayError("Error in Autoconfig", e);
}
